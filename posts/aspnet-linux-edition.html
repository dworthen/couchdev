<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/750db2f755193dfeff7f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/750db2f755193dfeff7f.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-6fd6122508a3ecee2da5.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.386717e5d53cbb6c2786.js" as="script"/><link rel="preload" href="/_next/static/chunks/71247caf95475e3ea7f9a0f8a30beb258b23d005.6e2460ecc34e06341fc5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-38d928fb62d663b3f9dd.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-8c30f50305d85407af2b.js" as="script"/></head><body><div id="__next"><div class="sc-1ho0hv8-0 hslvLF"><div><main><div><p><a href="https://www.microsoft.com/net/learn/apps/web">ASP.NET Core</a>; When the cross-platform version of the infamous ASP.NET we all love (to hate?) was released I immediately began exploring the process of deploying a .NET web application to a Linux host. After all, I was already running several <a href="https://nodejs.org">Node.js</a> web applications on a Linux box so why not add a few ASP.NET applications and host all apps under one roof. Plus I had to see it to believe it; a Microsoft web app running in a Linux environment!</p><p>In this article, I walk through the process of deploying an ASP.NET application to a Linux environment. The application will run inside a <a href="https://www.docker.com/">Docker</a> container within a Ubuntu host. The Docker environment is managed with <a href="http://dokku.viewdocs.io/dokku/">Dokku</a> which makes it possible to kick off builds and deployments with simple git pushes. Dokku will also handle (sub)domain routing by managing <a href="https://www.nginx.com/">nginx</a>; good riddance.</p><p><strong>Update:</strong> The final source code lives <a href="https://github.com/dworthen/aspnet-linux-edition/tree/1.0.0">here</a>.</p><hr/><h2>Setup</h2><ol><li><a href="https://dot.net">Download and install dotnet</a> on your development environment.</li><li><a href="http://dokku.viewdocs.io/dokku/getting-started/installation/">Install Dokku on a fresh Ubuntu environment</a>.<ul><li>I am using <a href="https://www.linode.com/">Linode</a> to host a Ubuntu 16.04 LTS environment. Instructions for installing Dokku on Linode can be found <a href="http://dokku.viewdocs.io/dokku~v0.6.2/getting-started/install/linode/">here</a>.</li><li>Alternatively, use <a href="https://msdn.microsoft.com/en-us/commandline/wsl/install-win10">Windows Subsystem for Linux</a> to explore this process on a local machine.</li></ul></li><li>[Optional]<!-- --> Point a <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">FQDN</a> towards the Ubuntu host. If using Linode, as I am, then check out their <a href="https://www.linode.com/docs/networking/dns/dns-manager-overview">DNS Manager</a>.<ul><li>For this article, I have both derekworthen.com, <code>&lt;SERVER_ADDRESS&gt;</code>, and blog-demo-aspnet-linux-environment.derekworthen.com, <code>&lt;FQDN&gt;</code>, pointing towards my Dokku configured server. <code>&lt;APP_NAME&gt;</code> refers to blog-demo-aspnet-linux-environment.</li></ul></li></ol><hr/><h2>App Creation</h2><p>Since this article is focused on the process of deploying to a Ubuntu host we will stick with creating a bare-bones web application. Visit Microsoft docs for an in-depth guide to <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/razor-pages/?tabs=visual-studio">getting started with ASP.NET Core</a>.</p><h4>.NET Core CLI</h4><p>At the time of this writing, I am using .Net CLI tools and SDK version 2.0.2 to create a sample app but any version of .NET Core should work.</p><p><strong>Note:</strong> Run <code>dotnet --info</code> to print out the version of dotnet CLI tools and SDK installed.</p><pre><code class="language-Bash">mkdir &lt;APP_NAME&gt; &amp;&amp; cd &lt;APP_NAME&gt; &amp;&amp; dotnet new razor
</code></pre><p>Verify the app builds and runs with <code>dotnet restore &amp;&amp; dotnet run</code>. Head over to localhost:5000 for a front row viewing of the out-of-the-box ASP.NET template in all its glory.</p><p><img src="/media/aspnetcore-app.png" alt="Default ASP.NET application running on port 5000"/></p><hr/><h2>App Management with Dokku</h2><p>Shell into the Ubuntu host as the dokku user account created during the setup process. I am using the <a href="https://msdn.microsoft.com/en-us/commandline/wsl/install-win10">Windows Subsystem for Linux</a> to drop into Bash and connect to the server instead of using an application like <a href="http://www.putty.org/">Putty</a>. Mac and Linux users can ignore the <code>bash -c</code> part of the command and delete the quotes surrounding the <code>ssh</code> command.</p><pre><code class="language-Bash">bash -c &quot;ssh dokku@&lt;SERVER_ADDRESS&gt;&quot;
</code></pre><h4>Dokku</h4><pre><code class="language-Bash"># Linux host
$ dokku apps:create &lt;APP_NAME&gt;
</code></pre><p>This will create a git repo at <code>&lt;SERVER_ADDRESS&gt;:&lt;APP_NAME&gt;</code>, e.g., derekworthen<!-- -->.<!-- -->com:blog-demo-aspnet-linux-environment in my case. Dokku will also register a reverse proxy routing with nginx using the <code>&lt;APP_NAME&gt;</code> as the subdomain to create the app&#x27;s <code>&lt;FQDN&gt;</code>, e.g., blog-demo-aspnet-linux-environment.derekworthen.com. By default, Dokku will configure nginix to route all traffic on port 80 and 443 (if SSL is enabled) that matches the <code>&lt;FQDN&gt;</code> to port 5000 of the app&#x27;s docker container.</p><h4>Git</h4><p>On the local machine, initialize git and add a remote location for the newly created dokku repo. (Don&#x27;t forget to add an <a href="https://www.gitignore.io/api/aspnetcore">appropriate</a> <a href="https://www.gitignore.io/">.gitignore</a> file to the project.)</p><pre><code class="language-Bash"># Local development machine
git init &amp;&amp; git add . &amp;&amp; git commit -m &quot;initial commit&quot;
# Must use the dokku user account created during the setup process
git remote add dokku dokku@&lt;SERVER_ADDRESS&gt;:&lt;APP_NAME&gt;
</code></pre><p>Up until now, we have been following the <a href="http://dokku.viewdocs.io/dokku/deployment/application-deployment/">basic guide for deploying a Dokku app</a>. We will now follow the instructions for <a href="http://dokku.viewdocs.io/dokku/deployment/methods/dockerfiles/">Dockerfile deployment</a>. Dokku will build, run and deploy a docker container based on the provided Dockerfile.</p><h4>Dockerfile; Building and Running ASP.NET Core Applications</h4><p>Create a <code>Dockerfile</code> in the root of the application with the following contents.</p><pre><code class="language-Dockerfile"># Stage 1. Building.
# May need use a different tag to get the build to work.
# https://hub.docker.com/r/microsoft/aspnetcore-build/
FROM microsoft/aspnetcore-build:2.0.2
WORKDIR /source

# caches restore result by copying csproj file separately
# copies project files into the /source/ of the container.
COPY *.csproj .

# Restore dotnet dependencies
RUN dotnet restore

# copies the rest of your code into /source/
COPY . .

# microsoft/aspnetcore-build image contains Node
# so may also run npm install
# or other npm related scripts.
# RUN npm install
# RUN npm run build

# Builds to /out in the root of the container
RUN dotnet publish --output /out/ --configuration Release

# Set environment variables for container
# Dokku maps external port 80 to internal port 5000 and
# the following lines tells ASP.NET to listen on port 5000
# May also omit the following line and add EXPOSE 80
# This will tell dokku to setup port mapping 80:80 instead 80:5000
# and omitting this environment variable will also tell ASP.NET Core
# to listen on port 80
ENV ASPNETCORE_URLS http://*:5000
# EXPOSE 80

# Stage 2. Running the application
WORKDIR /out
ENTRYPOINT [&quot;dotnet&quot;, &quot;&lt;APP_NAME&gt;.dll&quot;]
</code></pre><p>The above Dockerfile provides a runtime environment along with tools to build from source code. In a future article, I will cover deploying to a Dokku configured server using a CI/CD pipeline where the build artifacts are created prior to the Docker image. In such scenario, the Docker container does not need build tools and can be imaged from <code>microsoft/aspnetcore</code> for the runtime environment.</p><h4>Deploy</h4><p>It is finally time to push the project to the hosting server with git and watch Dokku build and run the application!</p><pre><code class="language-Bash">git add Dockerfile &amp;&amp; git commit -m &quot;Add Dockerfile&quot;
git push dokku master
</code></pre><p>If all goes well, Dokku will build and deploy a docker container housing our beautiful ASP.NET application and expose it to the world at the configured <code>&lt;FQDN&gt;</code>, e.g., <a href="http://blog-demo-aspnet-linux-environment.derekworthen.com/">http://blog-demo-aspnet-linux-environment.derekworthen.com/</a>.</p><p><img src="/media/deploy-dokku-app.png" alt="Deploying a Dokku app"/></p><h2>Conclusion</h2><p>Using Dokku as a simple <a href="https://en.wikipedia.org/wiki/Platform_as_a_service">PaaS</a>, we managed to deploy an ASP.NET Core web application to a Ubuntu server bundled as a Docker container. Now that the app creation and configuration is out of the way, changes pushed to the dokku remote location will rebuild and redeploy the application.</p><hr/><h2>Bonus; SSL Encryption</h2><p>With the <a href="https://letsencrypt.org/">Lets Encrypt</a> <a href="https://github.com/dokku/dokku-letsencrypt">Dokku plugin</a>, this could not be easier.</p><h4>Install</h4><pre><code class="language-Bash"># Need to be logged in as a sudo user instead of the dokku user account
$ sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git
</code></pre><h4>Configure</h4><pre><code class="language-Bash">$ dokku config:set --no-restart &lt;APP_NAME&gt; DOKKU_LETSENCRYPT_EMAIL=&lt;EMAIL&gt;
</code></pre><h4>Enable</h4><pre><code class="language-Bash">$ dokku letsencrypt &lt;APP_NAME&gt;
</code></pre><h4>Auto-renew</h4><pre><code class="language-Bash">$ dokku letsencrypt:cron-job --add
</code></pre><h4>Verify</h4><pre><code class="language-Bash">$ dokku proxy:report &lt;APP_NAME&gt;
</code></pre><p>Look for a https:443:5000 port mapping in the output.</p><h4>Test</h4><p>Open your favorite web browser and navigate to the https (or http as it should redirect to https) version of your site.</p></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.microsoft.com/net/learn/apps/web\"\n  }, \"ASP.NET Core\"), \"; When the cross-platform version of the infamous ASP.NET we all love (to hate?) was released I immediately began exploring the process of deploying a .NET web application to a Linux host. After all, I was already running several \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://nodejs.org\"\n  }, \"Node.js\"), \" web applications on a Linux box so why not add a few ASP.NET applications and host all apps under one roof. Plus I had to see it to believe it; a Microsoft web app running in a Linux environment!\"), mdx(\"p\", null, \"In this article, I walk through the process of deploying an ASP.NET application to a Linux environment. The application will run inside a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.docker.com/\"\n  }, \"Docker\"), \" container within a Ubuntu host. The Docker environment is managed with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://dokku.viewdocs.io/dokku/\"\n  }, \"Dokku\"), \" which makes it possible to kick off builds and deployments with simple git pushes. Dokku will also handle (sub)domain routing by managing \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.nginx.com/\"\n  }, \"nginx\"), \"; good riddance.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Update:\"), \" The final source code lives \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/dworthen/aspnet-linux-edition/tree/1.0.0\"\n  }, \"here\"), \".\"), mdx(\"hr\", null), mdx(\"h2\", null, \"Setup\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://dot.net\"\n  }, \"Download and install dotnet\"), \" on your development environment.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"http://dokku.viewdocs.io/dokku/getting-started/installation/\"\n  }, \"Install Dokku on a fresh Ubuntu environment\"), \".\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"I am using \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.linode.com/\"\n  }, \"Linode\"), \" to host a Ubuntu 16.04 LTS environment. Instructions for installing Dokku on Linode can be found \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"http://dokku.viewdocs.io/dokku~v0.6.2/getting-started/install/linode/\"\n  }, \"here\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Alternatively, use \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://msdn.microsoft.com/en-us/commandline/wsl/install-win10\"\n  }, \"Windows Subsystem for Linux\"), \" to explore this process on a local machine.\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"[Optional]\", \" Point a \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://en.wikipedia.org/wiki/Fully_qualified_domain_name\"\n  }, \"FQDN\"), \" towards the Ubuntu host. If using Linode, as I am, then check out their \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.linode.com/docs/networking/dns/dns-manager-overview\"\n  }, \"DNS Manager\"), \".\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"For this article, I have both derekworthen.com, \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"\u003cSERVER_ADDRESS\u003e\"), \", and blog-demo-aspnet-linux-environment.derekworthen.com, \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"\u003cFQDN\u003e\"), \", pointing towards my Dokku configured server. \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"\u003cAPP_NAME\u003e\"), \" refers to blog-demo-aspnet-linux-environment.\")))), mdx(\"hr\", null), mdx(\"h2\", null, \"App Creation\"), mdx(\"p\", null, \"Since this article is focused on the process of deploying to a Ubuntu host we will stick with creating a bare-bones web application. Visit Microsoft docs for an in-depth guide to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/aspnet/core/mvc/razor-pages/?tabs=visual-studio\"\n  }, \"getting started with ASP.NET Core\"), \".\"), mdx(\"h4\", null, \".NET Core CLI\"), mdx(\"p\", null, \"At the time of this writing, I am using .Net CLI tools and SDK version 2.0.2 to create a sample app but any version of .NET Core should work.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note:\"), \" Run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dotnet --info\"), \" to print out the version of dotnet CLI tools and SDK installed.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"mkdir \u003cAPP_NAME\u003e \u0026\u0026 cd \u003cAPP_NAME\u003e \u0026\u0026 dotnet new razor\\n\")), mdx(\"p\", null, \"Verify the app builds and runs with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dotnet restore \u0026\u0026 dotnet run\"), \". Head over to localhost:5000 for a front row viewing of the out-of-the-box ASP.NET template in all its glory.\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/media/aspnetcore-app.png\",\n    \"alt\": \"Default ASP.NET application running on port 5000\"\n  })), mdx(\"hr\", null), mdx(\"h2\", null, \"App Management with Dokku\"), mdx(\"p\", null, \"Shell into the Ubuntu host as the dokku user account created during the setup process. I am using the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://msdn.microsoft.com/en-us/commandline/wsl/install-win10\"\n  }, \"Windows Subsystem for Linux\"), \" to drop into Bash and connect to the server instead of using an application like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://www.putty.org/\"\n  }, \"Putty\"), \". Mac and Linux users can ignore the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bash -c\"), \" part of the command and delete the quotes surrounding the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssh\"), \" command.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"bash -c \\\"ssh dokku@\u003cSERVER_ADDRESS\u003e\\\"\\n\")), mdx(\"h4\", null, \"Dokku\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"# Linux host\\n$ dokku apps:create \u003cAPP_NAME\u003e\\n\")), mdx(\"p\", null, \"This will create a git repo at \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\u003cSERVER_ADDRESS\u003e:\u003cAPP_NAME\u003e\"), \", e.g., derekworthen\", \".\", \"com:blog-demo-aspnet-linux-environment in my case. Dokku will also register a reverse proxy routing with nginx using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\u003cAPP_NAME\u003e\"), \" as the subdomain to create the app's \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\u003cFQDN\u003e\"), \", e.g., blog-demo-aspnet-linux-environment.derekworthen.com. By default, Dokku will configure nginix to route all traffic on port 80 and 443 (if SSL is enabled) that matches the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\u003cFQDN\u003e\"), \" to port 5000 of the app's docker container.\"), mdx(\"h4\", null, \"Git\"), mdx(\"p\", null, \"On the local machine, initialize git and add a remote location for the newly created dokku repo. (Don't forget to add an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.gitignore.io/api/aspnetcore\"\n  }, \"appropriate\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.gitignore.io/\"\n  }, \".gitignore\"), \" file to the project.)\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"# Local development machine\\ngit init \u0026\u0026 git add . \u0026\u0026 git commit -m \\\"initial commit\\\"\\n# Must use the dokku user account created during the setup process\\ngit remote add dokku dokku@\u003cSERVER_ADDRESS\u003e:\u003cAPP_NAME\u003e\\n\")), mdx(\"p\", null, \"Up until now, we have been following the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://dokku.viewdocs.io/dokku/deployment/application-deployment/\"\n  }, \"basic guide for deploying a Dokku app\"), \". We will now follow the instructions for \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://dokku.viewdocs.io/dokku/deployment/methods/dockerfiles/\"\n  }, \"Dockerfile deployment\"), \". Dokku will build, run and deploy a docker container based on the provided Dockerfile.\"), mdx(\"h4\", null, \"Dockerfile; Building and Running ASP.NET Core Applications\"), mdx(\"p\", null, \"Create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" in the root of the application with the following contents.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Dockerfile\"\n  }, \"# Stage 1. Building.\\n# May need use a different tag to get the build to work.\\n# https://hub.docker.com/r/microsoft/aspnetcore-build/\\nFROM microsoft/aspnetcore-build:2.0.2\\nWORKDIR /source\\n\\n# caches restore result by copying csproj file separately\\n# copies project files into the /source/ of the container.\\nCOPY *.csproj .\\n\\n# Restore dotnet dependencies\\nRUN dotnet restore\\n\\n# copies the rest of your code into /source/\\nCOPY . .\\n\\n# microsoft/aspnetcore-build image contains Node\\n# so may also run npm install\\n# or other npm related scripts.\\n# RUN npm install\\n# RUN npm run build\\n\\n# Builds to /out in the root of the container\\nRUN dotnet publish --output /out/ --configuration Release\\n\\n# Set environment variables for container\\n# Dokku maps external port 80 to internal port 5000 and\\n# the following lines tells ASP.NET to listen on port 5000\\n# May also omit the following line and add EXPOSE 80\\n# This will tell dokku to setup port mapping 80:80 instead 80:5000\\n# and omitting this environment variable will also tell ASP.NET Core\\n# to listen on port 80\\nENV ASPNETCORE_URLS http://*:5000\\n# EXPOSE 80\\n\\n# Stage 2. Running the application\\nWORKDIR /out\\nENTRYPOINT [\\\"dotnet\\\", \\\"\u003cAPP_NAME\u003e.dll\\\"]\\n\")), mdx(\"p\", null, \"The above Dockerfile provides a runtime environment along with tools to build from source code. In a future article, I will cover deploying to a Dokku configured server using a CI/CD pipeline where the build artifacts are created prior to the Docker image. In such scenario, the Docker container does not need build tools and can be imaged from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"microsoft/aspnetcore\"), \" for the runtime environment.\"), mdx(\"h4\", null, \"Deploy\"), mdx(\"p\", null, \"It is finally time to push the project to the hosting server with git and watch Dokku build and run the application!\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"git add Dockerfile \u0026\u0026 git commit -m \\\"Add Dockerfile\\\"\\ngit push dokku master\\n\")), mdx(\"p\", null, \"If all goes well, Dokku will build and deploy a docker container housing our beautiful ASP.NET application and expose it to the world at the configured \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"\u003cFQDN\u003e\"), \", e.g., \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://blog-demo-aspnet-linux-environment.derekworthen.com/\"\n  }, \"http://blog-demo-aspnet-linux-environment.derekworthen.com/\"), \".\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/media/deploy-dokku-app.png\",\n    \"alt\": \"Deploying a Dokku app\"\n  })), mdx(\"h2\", null, \"Conclusion\"), mdx(\"p\", null, \"Using Dokku as a simple \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://en.wikipedia.org/wiki/Platform_as_a_service\"\n  }, \"PaaS\"), \", we managed to deploy an ASP.NET Core web application to a Ubuntu server bundled as a Docker container. Now that the app creation and configuration is out of the way, changes pushed to the dokku remote location will rebuild and redeploy the application.\"), mdx(\"hr\", null), mdx(\"h2\", null, \"Bonus; SSL Encryption\"), mdx(\"p\", null, \"With the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://letsencrypt.org/\"\n  }, \"Lets Encrypt\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/dokku/dokku-letsencrypt\"\n  }, \"Dokku plugin\"), \", this could not be easier.\"), mdx(\"h4\", null, \"Install\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"# Need to be logged in as a sudo user instead of the dokku user account\\n$ sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git\\n\")), mdx(\"h4\", null, \"Configure\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"$ dokku config:set --no-restart \u003cAPP_NAME\u003e DOKKU_LETSENCRYPT_EMAIL=\u003cEMAIL\u003e\\n\")), mdx(\"h4\", null, \"Enable\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"$ dokku letsencrypt \u003cAPP_NAME\u003e\\n\")), mdx(\"h4\", null, \"Auto-renew\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"$ dokku letsencrypt:cron-job --add\\n\")), mdx(\"h4\", null, \"Verify\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Bash\"\n  }, \"$ dokku proxy:report \u003cAPP_NAME\u003e\\n\")), mdx(\"p\", null, \"Look for a https:443:5000 port mapping in the output.\"), mdx(\"h4\", null, \"Test\"), mdx(\"p\", null, \"Open your favorite web browser and navigate to the https (or http as it should redirect to https) version of your site.\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003e\u003ca href=\"https://www.microsoft.com/net/learn/apps/web\"\u003eASP.NET Core\u003c/a\u003e; When the cross-platform version of the infamous ASP.NET we all love (to hate?) was released I immediately began exploring the process of deploying a .NET web application to a Linux host. After all, I was already running several \u003ca href=\"https://nodejs.org\"\u003eNode.js\u003c/a\u003e web applications on a Linux box so why not add a few ASP.NET applications and host all apps under one roof. Plus I had to see it to believe it; a Microsoft web app running in a Linux environment!\u003c/p\u003e\u003cp\u003eIn this article, I walk through the process of deploying an ASP.NET application to a Linux environment. The application will run inside a \u003ca href=\"https://www.docker.com/\"\u003eDocker\u003c/a\u003e container within a Ubuntu host. The Docker environment is managed with \u003ca href=\"http://dokku.viewdocs.io/dokku/\"\u003eDokku\u003c/a\u003e which makes it possible to kick off builds and deployments with simple git pushes. Dokku will also handle (sub)domain routing by managing \u003ca href=\"https://www.nginx.com/\"\u003enginx\u003c/a\u003e; good riddance.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eUpdate:\u003c/strong\u003e The final source code lives \u003ca href=\"https://github.com/dworthen/aspnet-linux-edition/tree/1.0.0\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\u003chr/\u003e\u003ch2\u003eSetup\u003c/h2\u003e\u003col\u003e\u003cli\u003e\u003ca href=\"https://dot.net\"\u003eDownload and install dotnet\u003c/a\u003e on your development environment.\u003c/li\u003e\u003cli\u003e\u003ca href=\"http://dokku.viewdocs.io/dokku/getting-started/installation/\"\u003eInstall Dokku on a fresh Ubuntu environment\u003c/a\u003e.\u003cul\u003e\u003cli\u003eI am using \u003ca href=\"https://www.linode.com/\"\u003eLinode\u003c/a\u003e to host a Ubuntu 16.04 LTS environment. Instructions for installing Dokku on Linode can be found \u003ca href=\"http://dokku.viewdocs.io/dokku~v0.6.2/getting-started/install/linode/\"\u003ehere\u003c/a\u003e.\u003c/li\u003e\u003cli\u003eAlternatively, use \u003ca href=\"https://msdn.microsoft.com/en-us/commandline/wsl/install-win10\"\u003eWindows Subsystem for Linux\u003c/a\u003e to explore this process on a local machine.\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003e[Optional]\u003c!-- --\u003e Point a \u003ca href=\"https://en.wikipedia.org/wiki/Fully_qualified_domain_name\"\u003eFQDN\u003c/a\u003e towards the Ubuntu host. If using Linode, as I am, then check out their \u003ca href=\"https://www.linode.com/docs/networking/dns/dns-manager-overview\"\u003eDNS Manager\u003c/a\u003e.\u003cul\u003e\u003cli\u003eFor this article, I have both derekworthen.com, \u003ccode\u003e\u0026lt;SERVER_ADDRESS\u0026gt;\u003c/code\u003e, and blog-demo-aspnet-linux-environment.derekworthen.com, \u003ccode\u003e\u0026lt;FQDN\u0026gt;\u003c/code\u003e, pointing towards my Dokku configured server. \u003ccode\u003e\u0026lt;APP_NAME\u0026gt;\u003c/code\u003e refers to blog-demo-aspnet-linux-environment.\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ol\u003e\u003chr/\u003e\u003ch2\u003eApp Creation\u003c/h2\u003e\u003cp\u003eSince this article is focused on the process of deploying to a Ubuntu host we will stick with creating a bare-bones web application. Visit Microsoft docs for an in-depth guide to \u003ca href=\"https://docs.microsoft.com/en-us/aspnet/core/mvc/razor-pages/?tabs=visual-studio\"\u003egetting started with ASP.NET Core\u003c/a\u003e.\u003c/p\u003e\u003ch4\u003e.NET Core CLI\u003c/h4\u003e\u003cp\u003eAt the time of this writing, I am using .Net CLI tools and SDK version 2.0.2 to create a sample app but any version of .NET Core should work.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eNote:\u003c/strong\u003e Run \u003ccode\u003edotnet --info\u003c/code\u003e to print out the version of dotnet CLI tools and SDK installed.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003emkdir \u0026lt;APP_NAME\u0026gt; \u0026amp;\u0026amp; cd \u0026lt;APP_NAME\u0026gt; \u0026amp;\u0026amp; dotnet new razor\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eVerify the app builds and runs with \u003ccode\u003edotnet restore \u0026amp;\u0026amp; dotnet run\u003c/code\u003e. Head over to localhost:5000 for a front row viewing of the out-of-the-box ASP.NET template in all its glory.\u003c/p\u003e\u003cp\u003e\u003cimg src=\"/media/aspnetcore-app.png\" alt=\"Default ASP.NET application running on port 5000\"/\u003e\u003c/p\u003e\u003chr/\u003e\u003ch2\u003eApp Management with Dokku\u003c/h2\u003e\u003cp\u003eShell into the Ubuntu host as the dokku user account created during the setup process. I am using the \u003ca href=\"https://msdn.microsoft.com/en-us/commandline/wsl/install-win10\"\u003eWindows Subsystem for Linux\u003c/a\u003e to drop into Bash and connect to the server instead of using an application like \u003ca href=\"http://www.putty.org/\"\u003ePutty\u003c/a\u003e. Mac and Linux users can ignore the \u003ccode\u003ebash -c\u003c/code\u003e part of the command and delete the quotes surrounding the \u003ccode\u003essh\u003c/code\u003e command.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003ebash -c \u0026quot;ssh dokku@\u0026lt;SERVER_ADDRESS\u0026gt;\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003eDokku\u003c/h4\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e# Linux host\n$ dokku apps:create \u0026lt;APP_NAME\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis will create a git repo at \u003ccode\u003e\u0026lt;SERVER_ADDRESS\u0026gt;:\u0026lt;APP_NAME\u0026gt;\u003c/code\u003e, e.g., derekworthen\u003c!-- --\u003e.\u003c!-- --\u003ecom:blog-demo-aspnet-linux-environment in my case. Dokku will also register a reverse proxy routing with nginx using the \u003ccode\u003e\u0026lt;APP_NAME\u0026gt;\u003c/code\u003e as the subdomain to create the app\u0026#x27;s \u003ccode\u003e\u0026lt;FQDN\u0026gt;\u003c/code\u003e, e.g., blog-demo-aspnet-linux-environment.derekworthen.com. By default, Dokku will configure nginix to route all traffic on port 80 and 443 (if SSL is enabled) that matches the \u003ccode\u003e\u0026lt;FQDN\u0026gt;\u003c/code\u003e to port 5000 of the app\u0026#x27;s docker container.\u003c/p\u003e\u003ch4\u003eGit\u003c/h4\u003e\u003cp\u003eOn the local machine, initialize git and add a remote location for the newly created dokku repo. (Don\u0026#x27;t forget to add an \u003ca href=\"https://www.gitignore.io/api/aspnetcore\"\u003eappropriate\u003c/a\u003e \u003ca href=\"https://www.gitignore.io/\"\u003e.gitignore\u003c/a\u003e file to the project.)\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e# Local development machine\ngit init \u0026amp;\u0026amp; git add . \u0026amp;\u0026amp; git commit -m \u0026quot;initial commit\u0026quot;\n# Must use the dokku user account created during the setup process\ngit remote add dokku dokku@\u0026lt;SERVER_ADDRESS\u0026gt;:\u0026lt;APP_NAME\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eUp until now, we have been following the \u003ca href=\"http://dokku.viewdocs.io/dokku/deployment/application-deployment/\"\u003ebasic guide for deploying a Dokku app\u003c/a\u003e. We will now follow the instructions for \u003ca href=\"http://dokku.viewdocs.io/dokku/deployment/methods/dockerfiles/\"\u003eDockerfile deployment\u003c/a\u003e. Dokku will build, run and deploy a docker container based on the provided Dockerfile.\u003c/p\u003e\u003ch4\u003eDockerfile; Building and Running ASP.NET Core Applications\u003c/h4\u003e\u003cp\u003eCreate a \u003ccode\u003eDockerfile\u003c/code\u003e in the root of the application with the following contents.\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-Dockerfile\"\u003e# Stage 1. Building.\n# May need use a different tag to get the build to work.\n# https://hub.docker.com/r/microsoft/aspnetcore-build/\nFROM microsoft/aspnetcore-build:2.0.2\nWORKDIR /source\n\n# caches restore result by copying csproj file separately\n# copies project files into the /source/ of the container.\nCOPY *.csproj .\n\n# Restore dotnet dependencies\nRUN dotnet restore\n\n# copies the rest of your code into /source/\nCOPY . .\n\n# microsoft/aspnetcore-build image contains Node\n# so may also run npm install\n# or other npm related scripts.\n# RUN npm install\n# RUN npm run build\n\n# Builds to /out in the root of the container\nRUN dotnet publish --output /out/ --configuration Release\n\n# Set environment variables for container\n# Dokku maps external port 80 to internal port 5000 and\n# the following lines tells ASP.NET to listen on port 5000\n# May also omit the following line and add EXPOSE 80\n# This will tell dokku to setup port mapping 80:80 instead 80:5000\n# and omitting this environment variable will also tell ASP.NET Core\n# to listen on port 80\nENV ASPNETCORE_URLS http://*:5000\n# EXPOSE 80\n\n# Stage 2. Running the application\nWORKDIR /out\nENTRYPOINT [\u0026quot;dotnet\u0026quot;, \u0026quot;\u0026lt;APP_NAME\u0026gt;.dll\u0026quot;]\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe above Dockerfile provides a runtime environment along with tools to build from source code. In a future article, I will cover deploying to a Dokku configured server using a CI/CD pipeline where the build artifacts are created prior to the Docker image. In such scenario, the Docker container does not need build tools and can be imaged from \u003ccode\u003emicrosoft/aspnetcore\u003c/code\u003e for the runtime environment.\u003c/p\u003e\u003ch4\u003eDeploy\u003c/h4\u003e\u003cp\u003eIt is finally time to push the project to the hosting server with git and watch Dokku build and run the application!\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003egit add Dockerfile \u0026amp;\u0026amp; git commit -m \u0026quot;Add Dockerfile\u0026quot;\ngit push dokku master\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIf all goes well, Dokku will build and deploy a docker container housing our beautiful ASP.NET application and expose it to the world at the configured \u003ccode\u003e\u0026lt;FQDN\u0026gt;\u003c/code\u003e, e.g., \u003ca href=\"http://blog-demo-aspnet-linux-environment.derekworthen.com/\"\u003ehttp://blog-demo-aspnet-linux-environment.derekworthen.com/\u003c/a\u003e.\u003c/p\u003e\u003cp\u003e\u003cimg src=\"/media/deploy-dokku-app.png\" alt=\"Deploying a Dokku app\"/\u003e\u003c/p\u003e\u003ch2\u003eConclusion\u003c/h2\u003e\u003cp\u003eUsing Dokku as a simple \u003ca href=\"https://en.wikipedia.org/wiki/Platform_as_a_service\"\u003ePaaS\u003c/a\u003e, we managed to deploy an ASP.NET Core web application to a Ubuntu server bundled as a Docker container. Now that the app creation and configuration is out of the way, changes pushed to the dokku remote location will rebuild and redeploy the application.\u003c/p\u003e\u003chr/\u003e\u003ch2\u003eBonus; SSL Encryption\u003c/h2\u003e\u003cp\u003eWith the \u003ca href=\"https://letsencrypt.org/\"\u003eLets Encrypt\u003c/a\u003e \u003ca href=\"https://github.com/dokku/dokku-letsencrypt\"\u003eDokku plugin\u003c/a\u003e, this could not be easier.\u003c/p\u003e\u003ch4\u003eInstall\u003c/h4\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e# Need to be logged in as a sudo user instead of the dokku user account\n$ sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003eConfigure\u003c/h4\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e$ dokku config:set --no-restart \u0026lt;APP_NAME\u0026gt; DOKKU_LETSENCRYPT_EMAIL=\u0026lt;EMAIL\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003eEnable\u003c/h4\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e$ dokku letsencrypt \u0026lt;APP_NAME\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003eAuto-renew\u003c/h4\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e$ dokku letsencrypt:cron-job --add\n\u003c/code\u003e\u003c/pre\u003e\u003ch4\u003eVerify\u003c/h4\u003e\u003cpre\u003e\u003ccode class=\"language-Bash\"\u003e$ dokku proxy:report \u0026lt;APP_NAME\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eLook for a https:443:5000 port mapping in the output.\u003c/p\u003e\u003ch4\u003eTest\u003c/h4\u003e\u003cp\u003eOpen your favorite web browser and navigate to the https (or http as it should redirect to https) version of your site.\u003c/p\u003e","scope":{}},"frontMatter":{"title":"ASP.NET Core. Linux Edition","date":"2017-11-12","template":"post","published":true,"slug":"aspnet-linux-edition","category":"ASP.NET Core","tags":["ASP.NET Core","Linux","Docker"],"description":"ASP.NET Core + Linux = Freedom. Love ASP.NET? What about Linux? Do you wish to bring the two together? Well now you can with ASP.NET core. Deploy your favorite web stack to your favorate hosting environment. Or, develop from the comfort of your favorite MacBook or Linux box."}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"aspnet-linux-edition"},"buildId":"c-PzTcYntvLLEE3J2MI77","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-4a659121523c89b6d810.js"></script><script src="/_next/static/chunks/main-6fd6122508a3ecee2da5.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.386717e5d53cbb6c2786.js" async=""></script><script src="/_next/static/chunks/71247caf95475e3ea7f9a0f8a30beb258b23d005.6e2460ecc34e06341fc5.js" async=""></script><script src="/_next/static/chunks/pages/_app-38d928fb62d663b3f9dd.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-8c30f50305d85407af2b.js" async=""></script><script src="/_next/static/c-PzTcYntvLLEE3J2MI77/_buildManifest.js" async=""></script><script src="/_next/static/c-PzTcYntvLLEE3J2MI77/_ssgManifest.js" async=""></script></body></html>